# VoiceChatMod with AWS Integration

This Minecraft mod implements a voice chat feature leveraging AWS services like AppSync for real-time communication and Cognito for authentication. The backend infrastructure is managed by Terraform and is detailed in the [gameserver repository](https://github.com/LeChienCour/gameserver) (Note: please ensure this link points to your actual public/intended Terraform repository if different).

## Project Goal

To create a functional voice chat mod for Minecraft using NeoForge, with its backend services (signaling, authentication) hosted on AWS. This project also serves as a learning experience and a demonstration for the AWS Community Day presentation on June 14th.

## Current Status (as of May 15, 2025)

* **Client-Side Audio:** Microphone capture, local audio playback, and Push-to-Talk (PTT) functionality are implemented.
* **AWS Service Placeholder:** A minimal `AppSyncClientService` class is in place in the mod. It currently validates configuration parameters (AppSync URL, API Key, Region) but does not yet establish a live connection or perform GraphQL operations.
* **AWS Infrastructure:** Terraform scripts for deploying AppSync, Cognito, and an EC2 game server are located in the `gameserver` repository. The AppSync API is configured with Cognito User Pools as the primary authentication and API Key as an additional method for initial testing.
* **Build System:** Gradle is configured with the AWS SDK v2 BOM. We are working through ensuring correct dependency resolution for AWS SDK modules.

## Important Notes for Development and Testing

### Dynamic AWS Infrastructure Values

The AWS infrastructure (AppSync API, Cognito User Pool, EC2 instance, etc.) is deployed via Terraform. For development, testing, and cost management purposes, **this infrastructure may be frequently destroyed and redeployed using `terraform destroy` and `terraform apply` from the `gameserver` repository.**

**Consequence:** Critical endpoint URLs, API Keys, and other identifiers generated by AWS (like Cognito Pool ID, AppSync API ID) **WILL CHANGE** each time the infrastructure is fully redeployed.

**Action Required After Each Redeployment:**
When the infrastructure is redeployed, you **MUST** obtain the new output values from your Terraform deployment (using `terraform output` in the `gameserver` project directory) and update the Minecraft mod's client-side configuration file accordingly.

**Mod Configuration File Location:**
`[YourMinecraftInstanceFolder]/runs/client/config/voicechatmod-common.toml`

**Values to Update in `voicechatmod-common.toml`:**
* `voiceServerUrl`: The HTTPS GraphQL endpoint URL for your AWS AppSync API.
    * Obtain from `terraform output appsync_graphql_api_uri`.
* `appSyncApiKey`: The API Key generated for your AppSync API.
    * Obtain from `terraform output appsync_api_key_value`.
* `appSyncApiRegion`: The AWS Region where your AppSync API is deployed (e.g., "us-east-1").
    * Obtain from `terraform output appsync_api_region`.

*(Future configuration parameters might include Cognito IDs once that integration is active).*

### AWS SDK Dependency Resolution

We have encountered and are working through challenges ensuring Gradle correctly resolves and includes all necessary AWS SDK v2 JARs on the mod's runtime classpath. The current approach involves:
1.  Using the AWS SDK BOM (`software.amazon.awssdk:bom:2.25.48`).
2.  Adding explicit `implementation` dependencies for specific AWS SDK modules as needed (e.g., `sdk-core`, `regions`, an HTTP client like `url-connection-client` or `apache-client`).
3.  Thorough Gradle cache cleaning and project synchronization if `NoClassDefFoundError` or symbol resolution errors occur.

### Future: Secrets Management & SSM Parameter Store

The current method of placing the `appSyncApiKey` in the client-side `.toml` file is for **development and initial testing convenience only** for this specific project and presentation timeline.

**Planned improvements for a more robust and secure setup include:**
* **Backend Configuration:** Storing sensitive operational parameters that the *backend services themselves* might need (e.g., internal API keys between microservices, database credentials if any) in AWS Systems Manager (SSM) Parameter Store as SecureString parameters, accessed via IAM Roles.
* **Client Authentication:** Transitioning fully to Amazon Cognito for user authentication. The client mod will use standard Cognito authentication flows (e.g., SRP for password authentication) to obtain JWTs. These JWTs will then be used to authorize requests to AppSync. This means the mod client itself won't handle long-lived "secrets" for AppSync directly, but rather user-specific, short-lived tokens.
* **Client-Side Configuration:** Non-sensitive identifiers like the AppSync endpoint, Cognito User Pool ID, and Client ID will remain in the client's configuration file.
* **SSM for Client Mod Configuration:** Direct fetching of configuration by the distributed client mod from SSM Parameter Store is **not** the planned approach due to the complexities and security risks of distributing AWS credentials with SSM access permissions to all game clients.

This README will be updated as the project progresses.